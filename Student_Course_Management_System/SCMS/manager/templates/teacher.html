{% extends "base.html" %}

{% block title%}SCMS - Teacher{% endblock%}

{% block content %}  
    
     <h1>Teachers</h1>

{% comment %} Search + Add Button {% endcomment %}
     <div>
          <form method="get" action="{% url 'teacher_list' %}">
               <input type="text" name="search">
               <button>Search</button>
          </form>
     </div>
     <div>
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTeacherModal">
               Add Teacher
          </button>
     </div>

{% comment %} Teacher Card {% endcomment %}
     <div class="container">
          <div class="row">

               {% for teacher in teachers %}
                    <div class="col-md-4 mb-4">
                         <div class="card shadow h-120 j" >                    
                              <div class="card-body text-center">
                                   {% if teacher.teacher_image %}
                                        <img src="{{ teacher.teacher_image.url }}" class="rounded-circle" style="width:120px;height:120px; object-fit:cover;">
                                   {% endif %}
                                   <h4>{{ teacher.teacher_name }}</h4>                         
                                   <p><strong>Phone:</strong> {{ teacher.teacher_phone }}</p>
                                   <p><strong>Email:</strong> {{ teacher.teacher_email }}</p>
                                   <hr>
                                   <strong>Courses:</strong><br>
                                   {% for course in teacher.courses.all%}
                                        <span class="badge bg-info text-dark">{{ course.course_name }}</span>
                                   {% empty %}
                                        <span class="text-muted">No courses</span>
                                   {% endfor %}                         
                              </div>
                              <div class="card-footer text-center">
                                   <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ teacher.id }}">
                                        Edit
                                   </button>
                                   <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ teacher.id }}">
                                        Delete
                                   </button>
                              </div>
                         </div>
                    </div>
               {% endfor%}
          </div>
     </div>

     <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">

               {% if page_obj.has_previous %}
                    <li class="page-item">
                         <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                    </li>
               {% endif %}

               {% for num in page_obj.paginator.page_range %}
                    <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                         <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
               {% endfor %}

               {% if page_obj.has_next %}
                    <li class="page-item">
                         <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                    </li>
               {% endif %}
          </ul>
     </nav>

{% comment %} Add Teacher modal {% endcomment %}

     <div class="modal fade" id="addTeacherModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
          <div class="modal-dialog">
               <form method="post" action="{% url 'add_teacher' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-content">
                         <div class="modal-header">
                              <h5 class="modal-title">Add Teacher</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                         </div>
                         <div class="modal-body">
                              {{form.as_p}}     
                         </div>
                         <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              <button type="submit" class="btn btn-success">Save</button>
                         </div>
                    </div>
               </form>
          </div>
     </div>

{% comment %} Edit Teacher Modal (Inside Loop) {% endcomment %}

     {% for teacher in teachers %}
          <div class="modal fade" id="editModal{{ teacher.id }}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
               <div class="modal-dialog">
                    <form method="post" action="{% url 'edit_teacher' teacher.id %}" class="form-control" enctype="multipart/form-data">
                         {% csrf_token %}
                         <div class="modal-content">
                              <div class="modal-header">
                                   <h5>Edit Course</h5>
                                   <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                              </div>
                              <div class="modal-body">
                                   {{teacher.form.as_p}}
                              </div>
                              <div class="modal-footer">
                                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                   <button type="submit" class="btn btn-success">Update</button>
                              </div>
                         </div>
                    </form>
               </div>
          </div>
     {% endfor %}

 {% comment %} Delete Teacher Modal {% endcomment %}

     {% for teacher in teachers %}
          <div class="modal fade" id="deleteModal{{ teacher.id }}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
               <div class="modal-dialog">
                    <form method="post" action="{% url 'delete_teacher' teacher.id %}">
                         {% csrf_token %}
                         <div class="modal-content">
                              <div class="modal-header">
                                   <h5>Delete Teacher</h5>
                                   <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                              </div>
                              <div class="modal-body text-center">
                                   Delete <strong>{{ teacher.teacher_name }}</strong>?
                              </div>
                              <div class="modal-footer">
                                   <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                   <button class="btn btn-danger">Yes</button>
                              </div>
                         </div>
                    </form>
               </div>
          </div>
     {% endfor %}
   
{% endblock %}